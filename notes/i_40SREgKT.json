{"_id":"note:i_40SREgKT","title":"Early Stopping","content":"# Early Stopping\n\n当一些情况发生，我们可能需要提早结束训练，这时候就需要提早结束训练。\n\n## 1.EarlyStopping Callback\n\n这个函数可以用来监视指标并在模型没有提升时候结束。具体的，\n\n- 导入依赖\n- Log你要观测的指标\n- 初始化callback，设置monitor\n- 根据指标设置mode\n- 将 EarlyStopping callback 传递给 Trainer\n\n    from lightning.pytorch.callbacks.early_stopping import EarlyStopping\n\n\n    class LitModel(LightningModule):\n        def validation_step(self, batch, batch_idx):\n            loss = ...\n            self.log(\"val_loss\", loss)\n\n\n    model = LitModel()\n    trainer = Trainer(callbacks=[EarlyStopping(monitor=\"val_loss\", mode=\"min\")])\n    trainer.fit(model)\n    \n你可以自定义callback通过更改参数的方式\n\n    early_stop_callback = EarlyStopping(monitor=\"val_accuracy\", min_delta=0.00, patience=3, verbose=False, mode=\"max\")\n    trainer = Trainer(callbacks=[early_stop_callback])\n    \n其他的参数：\n\n- stopping_threshold: Stops training immediately once the monitored quantity reaches this threshold. It is useful when we know that going beyond a certain optimal value does not further benefit us.\n\n- divergence_threshold: Stops training as soon as the monitored quantity becomes worse than this threshold. When reaching a value this bad, we believes the model cannot recover anymore and it is better to stop early and run with different initial conditions.\n\n- check_finite: When turned on, it stops training if the monitored metric becomes NaN or infinite.\n\n- check_on_train_epoch_end: When turned on, it checks the metric at the end of a training epoch. Use this only when you are monitoring any metric logged within training-specific hooks on epoch-level.\n\n如果你需要以不同的方式结果，可以自定义EarlyStopping\n\n    class MyEarlyStopping(EarlyStopping):\n        def on_validation_end(self, trainer, pl_module):\n            # override this to disable early stopping at the end of val loop\n            pass\n\n        def on_train_end(self, trainer, pl_module):\n            # instead, do it at the end of training loop\n            self._run_early_stopping_check(trainer)\n\n> The EarlyStopping callback runs at the end of every validation epoch by default(默认情况下是在验证后进行结束). However, the frequency of validation can be modified by setting various parameters in the Trainer, for example check_val_every_n_epoch and val_check_interval. It must be noted that the patience parameter counts the number of validation checks with no improvement, and not the number of training epochs. Therefore, with parameters check_val_every_n_epoch=10 and patience=3, the trainer will perform at least 40 training epochs before being stopped.","tags":[],"folderPathname":"/Tutorial/Pytorch_Lightning/Basic/Add a Validation and test set","data":{},"createdAt":"2024-02-22T05:54:52.979Z","updatedAt":"2024-02-22T06:09:33.863Z","trashed":false,"_rev":"xJvXiqfCi"}